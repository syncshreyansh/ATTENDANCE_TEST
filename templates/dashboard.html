<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Attendance Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/dashboard.css') }}"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="dashboard-container">
      <header class="header glass-card">
        <div class="header-content">
          <div class="logo-section">
            <h1><i class="fas fa-graduation-cap"></i> Smart Attendance</h1>
          </div>
          <div class="controls-section">
            <div class="theme-toggle" id="themeToggle">
              <div class="theme-toggle-slider"></div>
              <i class="fas fa-sun theme-icon sun-icon"></i>
              <i class="fas fa-moon theme-icon moon-icon"></i>
            </div>
            <button id="startSystem" class="liquid-button success">
              <i class="fas fa-play"></i> Start
            </button>
            <button id="stopSystem" class="liquid-button danger" disabled>
              <i class="fas fa-stop"></i> Stop
            </button>
            <div class="status-indicator">
              <div class="status-dot offline" id="statusDot"></div>
              <span id="statusText">Offline</span>
            </div>
            <button id="logoutBtn" class="liquid-button">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </header>

      <div class="stats-grid">
        <div class="stat-card glass-card" style="--index: 0">
          <div class="stat-card-inner">
            <div class="stat-content">
              <h3 id="presentCount">0</h3>
              <p>Present Today</p>
            </div>
            <div class="stat-icon"><i class="fas fa-user-check"></i></div>
          </div>
        </div>
        <div class="stat-card glass-card" style="--index: 1">
          <div class="stat-card-inner">
            <div class="stat-content">
              <h3 id="absentCount">0</h3>
              <p>Absent Today</p>
            </div>
            <div class="stat-icon"><i class="fas fa-user-times"></i></div>
          </div>
        </div>
        <div class="stat-card glass-card" style="--index: 2">
          <div class="stat-card-inner">
            <div class="stat-content">
              <h3 id="attendanceRate">0%</h3>
              <p>Attendance Rate</p>
            </div>
            <div class="stat-icon"><i class="fas fa-percentage"></i></div>
          </div>
        </div>
        <div class="stat-card glass-card" style="--index: 3">
          <div class="stat-card-inner">
            <div class="stat-content">
              <h3 id="totalStudents">0</h3>
              <p>Total Students</p>
            </div>
            <div class="stat-icon"><i class="fas fa-users"></i></div>
          </div>
        </div>
      </div>

      <div class="main-grid">
        <section class="glass-card">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-video"></i> Live Recognition
            </h2>
            <button id="enrollBtn" class="liquid-button">
              <i class="fas fa-user-plus"></i> Enroll Student
            </button>
          </div>
          <div class="live-feed" id="liveFeed">
            <video id="liveFeedVideo" autoplay playsinline muted></video>
            <div class="feed-placeholder" id="feedPlaceholder">
              <i class="fas fa-camera-slash"></i>
              <p>Camera Feed Inactive</p>
            </div>
            
            <div id="recognitionOverlay" class="recognition-overlay">
              <span id="recognitionOverlayText"></span>
            </div>
          </div>
        </section>

        <section class="glass-card">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-history"></i> Recent Events
            </h2>
          </div>
          <div class="scrollable-list" id="recentEvents">
            <p style="text-align: center; color: var(--text-secondary)">
              No events yet
            </p>
          </div>
        </section>
      </div>
    </div>

    <!-- ENROLLMENT MODAL -->
    <div class="modal" id="enrollModal">
      <div class="modal-content glass-card">
        <div class="modal-header">
          <h2>Enroll New Student</h2>
          <span class="close-modal" id="closeModal">&times;</span>
        </div>
        
        <div class="modal-body-split">
          <!-- LEFT PANEL: Camera Preview -->
          <div class="modal-left-panel">
            <div class="camera-preview-box">
              <video id="videoPreview" autoplay playsinline muted></video>
              <canvas id="photoCanvas"></canvas>
            </div>
            
            <div class="capture-button-container">
              <button type="button" id="capturePhoto" class="liquid-button">
                <i class="fas fa-camera"></i> Capture Photo
              </button>
              <button type="button" id="recapturePhoto" class="liquid-button hidden">
                <i class="fas fa-redo"></i> Retake Photo
              </button>
            </div>
          </div>

          <!-- RIGHT PANEL: Student Form -->
          <div class="modal-right-panel">
            <form id="enrollForm">
              <div class="form-group">
                <label for="studentName">Student Name <span style="color: red;">*</span></label>
                <input
                  type="text"
                  id="studentName"
                  class="form-input"
                  placeholder="Enter full name (alphabets only)"
                  required
                  pattern="[A-Za-z\s]+"
                  title="Only alphabets and spaces allowed"
                />
              </div>

              <div class="form-group">
                <label for="studentId">Student ID <span style="color: red;">*</span></label>
                <input
                  type="text"
                  id="studentId"
                  class="form-input"
                  placeholder="Enter student ID"
                  required
                  minlength="3"
                />
              </div>

              <div class="form-group">
                <label for="studentClass">Class <span style="color: red;">*</span></label>
                <input
                  type="text"
                  id="studentClass"
                  class="form-input"
                  placeholder="e.g., 10"
                  required
                />
              </div>

              <div class="form-group">
                <label for="studentSection">Section <span style="color: red;">*</span></label>
                <input
                  type="text"
                  id="studentSection"
                  class="form-input"
                  placeholder="e.g., A"
                  required
                />
              </div>

              <div class="form-group">
                <label for="parentPhone">Parent Phone <span style="color: red;">*</span></label>
                <input
                  type="tel"
                  id="parentPhone"
                  class="form-input"
                  placeholder="Enter 10-15 digit phone number"
                  required
                  pattern="[0-9]{10,15}"
                  title="Phone number must be 10-15 digits only"
                  minlength="10"
                  maxlength="15"
                />
              </div>

              <div class="form-actions">
                <button type="button" id="cancelEnroll" class="liquid-button">
                  Cancel
                </button>
                <button type="submit" id="enrollSubmitBtn" class="liquid-button success" disabled>
                  <i class="fas fa-check"></i> Submit
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
  </body>
</html>